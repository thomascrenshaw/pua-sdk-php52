<html>
    <head>
        <script
            type="text/javascript"
            src="../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Pop Up Archive API SDK written in PHP (&gt;=5.2)
 *
 * @category  File
 * @package   Popuparchive_Services
 * @author    Thomas Crenshaw &lt;thomascrenshaw@gmail.com&gt;
 * @copyright 2014 Pop Up Archive &lt;info@popuparchive.org&gt;
 * @license   GNU AFFERO GENERAL PUBLIC LICENSE &lt;http://www.gnu.org/licenses/agpl.html&gt;
 * @link      http://github.com/popuparchive/pua-api-php52
 */
require_once 'lib/Exception.php';
require_once 'lib/Version.php';

/**
 * Pop Up Archive API SDK
 *
 * @category  Services
 * @author    Thomas Crenshaw &lt;thomascrenshaw@gmail.com&gt;
 * @copyright 2014 Pop Up Archive &lt;info@popuparchive.org&gt;
 * @license   GNU AFFERO GENERAL PUBLIC LICENSE &lt;http://www.gnu.org/licenses/agpl.html&gt;
 * @link      http://github.com/popuparchive/pua-api-php52
 *
 * PSR1 - https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-1-basic-coding-standard.md
 * PSR2 - https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md
 */
class Popuparchive_Services
{
    /**
     * Custom cURL option
     *
     * @var integer
     *
     * @access public
     */
    const CURLOPT_OAUTH_TOKEN = 1337;
    /**
     * Default cURL options
     *
     * @var array
     *
     * @access private
     * @static
     */
     private static $_curlDefaultOptions = array(
         CURLOPT_HEADER =&gt; true,
         CURLOPT_RETURNTRANSFER =&gt; true,
         CURLOPT_USERAGENT =&gt; ''
     );

    /**
     * cURL options
     *
     * @var array
     *
     * @access private
     */
    private $_curlOptions;

    /**
     * API domain
     *
     * @var string
     *
     * @access private
     * @static
     */
    private $_domain = 'www.popuparchive.org';

    /**
     * HTTP response body from the last request
     *
     * @var string
     *
     * @access private
     */
    private $_lastHttpResponseBody;

    /**
     * HTTP response code from the last request
     *
     * @var integer
     *
     * @access private
     */
    private $_lastHttpResponseCode;

    /**
     * HTTP response headers from last request
     *
     * @var array
     *
     * @access private
     */
    private $_lastHttpResponseHeaders;

    /**
     * Available response formats
     *
     * @var array
     *
     * @access private
     * @static
     */
    private static $_responseFormats = array(
        '*' =&gt; '*/*',
        'json' =&gt; 'application/json'
    );

    /**
     * HTTP user agent
     *
     * @var string
     *
     * @access private
     * @static
     */
    private static $_userAgent = 'SDK-PHP52-Popuparchive';

    /**
     * Class constructor
     *
     * @return void
     *
     * @access public
     */
    public function __construct()
    {
        $this-&gt;_responseFormat = self::$_responseFormats['json'];
        $this-&gt;_curlOptions = self::$_curlDefaultOptions;
        $this-&gt;_curlOptions[CURLOPT_USERAGENT] .= $this-&gt;getUserAgent();
    }

    /**
     * Get cURL options
     *
     * @return mixed
     *
     * @access public
     */
    public function getCurlOptions()
    {
        return $this-&gt;_curlOptions;
    }

    /**
     * Get HTTP response header
     *
     * @param string $header Name of the header
     *
     * @return mixed
     *
     * @access public
     */
    public function getHttpHeader($header)
    {
        if (is_array($this-&gt;_lastHttpResponseHeaders)) {
            return $this-&gt;_lastHttpResponseHeaders[$header];
        } else {
            return false;
        }
    }

    /**
     * Get response format
     *
     * @return string
     *
     * @access public
     */
    public function getResponseFormat()
    {
        return $this-&gt;_responseFormat;
    }

    /**
     * Set cURL options
     *
     * The method accepts arguments in two ways.
     *
     * You could pass two arguments when adding a single option.
     * &lt;code&gt;
     * $popuparchive-&gt;setCurlOptions(CURLOPT_SSL_VERIFYHOST, 0);
     * &lt;/code&gt;
     *
     * You could also pass an associative array when adding multiple options.
     * &lt;code&gt;
     * $popuparchive-&gt;setCurlOptions(array(
     *     CURLOPT_SSL_VERIFYHOST =&gt; 0,
     *    CURLOPT_SSL_VERIFYPEER =&gt; 0
     * ));
     * &lt;/code&gt;
     *
     * @return object
     *
     * @access public
     */
    public function setCurlOptions()
    {
        $args = func_get_args();
        $options = (is_array($args[0]))
            ? $args[0]
            : array($args[0] =&gt; $args[1]);

        foreach ($options as $key =&gt; $val) {
            $this-&gt;_curlOptions[$key] = $val;
        }

        return $this;
    }

    /**
     * Set response format
     *
     * @param string $format Response format
     *
     * @return object
     * @throws Popuparchive_Services_Exception_Unsupported_Response_Format
     *
     * @access public
     */
    public function setResponseFormat($format)
    {
        if (array_key_exists($format, self::$_responseFormats)) {
            $this-&gt;_responseFormat = self::$_responseFormats[$format];
        } else {
            throw new Popuparchive_Services_Exception_Unsupported_Response_Format();
        }

        return $this;
    }

    /**
     * Send a GET HTTP request
     *
     * @param string $path        Request path
     * @param array  $params      Optional query string parameters
     * @param array  $curlOptions Optional cURL options
     *
     * @return mixed
     *
     * @access public
     * @see Popuparchive::request()
     */
    public function get($path, $params = array(), $curlOptions = array())
    {
        $url = $this-&gt;buildUrl($path, $params);

        return $this-&gt;request($url, $curlOptions);
    }

    /**
     * Get a Pop Up Archive collectoin by its ID
     *
     * @param string $collectionId Request path
     * @param array  $params       Optional query string parameters
     * @param array  $curlOptions  Optional cURL options
     *
     * @example popuparchive_examples.php 21 2 example call for getCollectionById
     *
     * @return JSON
     *
     * @access public
     * @see Popuparchive::request()
     */
    public function getCollectionById($collectionId, $params = array(), $curlOptions = array())
    {
        $url = $this-&gt;buildURL(
            'collections/'.$collectionId,
            $params
        );

        return $this-&gt;request($url, $curlOptions);
    }

    /**
     * Get a Pop Up Archive item by its ID and associated Collection ID
     *
     * @param string $collectionId Request path
     * @param string $itemId       Request path
     * @param array  $params       Optional query string parameters
     * @param array  $curlOptions  Optional cURL options
     *
     * @return mixed
     *
     * @access public
     * @see Popuparchive::request()
     */
    public function getItemById($collectionId, $itemId, $params = array(), $curlOptions = array())
    {
        $url = $this-&gt;buildURL(
            'collections/'.$collectionId.'/items/'.$itemId,
            $params
        );

        return $this-&gt;request($url, $curlOptions);
    }

    /**
     * Search Pop Up Archive, with search set narrowed down by a filter
     *
     * @param string $filterKey   filter type - only filter currently available is 'collection_id'
     * @param string $filterValue filter value
     * @param array  $params      Optional query string parameters; format -- array('query'=&gt;'chicago OR american','page'=&gt;&quot;1&quot;);
     * @param array  $curlOptions Optional cURL options
     *
     * @return mixed
     *
     * @access public
     * @see Popuparchive::request()
     */
    public function searchByFilter($filterKey, $filterValue, $params = array(), $curlOptions = array())
    {
        if (($filterKey) &amp;&amp; ($filterValue)) {
            $filterArray = array('filters['.$filterKey.']' =&gt; $filterValue);
            $query = array_merge($filterArray, $params);
            $url = $this-&gt;buildURL(
                'search',
                $query
            );
        }

        return $this-&gt;request($url, $curlOptions);
    }

    /**
     * Construct a URL
     *
     * @param string $path   Relative or absolute URI
     * @param array  $params Optional query string parameters
     *
     * @return string $url
     *
     * @access protected
     */
    protected function buildUrl($path, $params = array())
    {
        if (preg_match('/^https?\:\/\//', $path)) {
            $url = $path;
        } else {
            $url = 'https://';
            $url .= $this-&gt;_domain;
            $url .= '/api/';
            $url .= $path;
        }

        $url .= (count($params)) ? '?' . http_build_query($params) : '';
        echo(&quot;url is &quot;.$url.&quot;&lt;br/&gt;&quot;);
        return $url;
    }

    /**
     * Construct default HTTP request headers
     *
     * @return array $headers
     *
     * @access protected
     */
    protected function buildDefaultHeaders()
    {
        $headers = array();

        if ($this-&gt;_responseFormat) {
            array_push($headers, 'Accept: ' . $this-&gt;_responseFormat);
        }

        return $headers;
    }

    /**
     * Get HTTP user agent
     *
     * @return string
     *
     * @access protected
     */
    protected function getUserAgent()
    {
        return self::$_userAgent . '/' . new Popuparchive_Services_Version;
    }

    /**
     * Parse HTTP headers
     *
     * @param string $headers HTTP headers
     *
     * @return array $parsedHeaders
     *
     * @access protected
     */
    protected function parseHttpHeaders($headers)
    {
        $headers = explode(&quot;\n&quot;, trim($headers));
        $parsedHeaders = array();

        foreach ($headers as $header) {
            if (!preg_match('/\:\s/', $header)) {
                continue;
            }

            list($key, $val) = explode(': ', $header, 2);
            $key = str_replace('-', '_', strtolower($key));
            $val = trim($val);

            $parsedHeaders[$key] = $val;
        }

        return $parsedHeaders;
    }

    /**
     * Validate HTTP response code
     *
     * @param integer $code HTTP code
     *
     * @return boolean
     *
     * @access protected
     */
    protected function validResponseCode($code)
    {
        return (bool) preg_match('/^20[0-9]{1}$/', $code);
    }

    /**
     * Performs the actual HTTP request using cURL
     *
     * @param string $url         Absolute URL to request
     * @param array  $curlOptions Optional cURL options
     *
     * @return mixed
     * @throws Popuparchive_Services_Exception_Invalid_Http_Response_Code
     * @uses Popuparchive_Services_Exception_Invalid_Http_Response_Code to throw error
     *
     * @access protected
     */
    protected function request($url, $curlOptions = array())
    {
        $curlinit = curl_init($url);
        $options = $this-&gt;_curlOptions;
        $options += $curlOptions;

        $includeAccessToken = false;

        if (array_key_exists(CURLOPT_HTTPHEADER, $options)) {
            $options[CURLOPT_HTTPHEADER] = array_merge(
                $this-&gt;buildDefaultHeaders(),
                $curlOptions[CURLOPT_HTTPHEADER]
            );
        } else {
            $options[CURLOPT_HTTPHEADER] = $this-&gt;buildDefaultHeaders(
                $includeAccessToken
            );
        }

        curl_setopt_array($curlinit, $options);

        $data = curl_exec($curlinit);
        $info = curl_getinfo($curlinit);

        curl_close($curlinit);

        if (array_key_exists(CURLOPT_HEADER, $options) &amp;&amp; $options[CURLOPT_HEADER]) {
            $this-&gt;_lastHttpResponseHeaders = $this-&gt;parseHttpHeaders(
                substr($data, 0, $info['header_size'])
            );
            $this-&gt;_lastHttpResponseBody = substr($data, $info['header_size']);
        } else {
            $this-&gt;_lastHttpResponseHeaders = array();
            $this-&gt;_lastHttpResponseBody = $data;
        }

        $this-&gt;_lastHttpResponseCode = $info['http_code'];

        if ($this-&gt;validResponseCode($this-&gt;_lastHttpResponseCode)) {
            return $this-&gt;_lastHttpResponseBody;
        } else {
            throw new Popuparchive_Services_Exception_Invalid_Http_Response_Code(
                null,
                0,
                $this-&gt;_lastHttpResponseBody,
                $this-&gt;_lastHttpResponseCode
            );
        }
    }
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>